"use strict";(()=>{var dn=Object.create;var Ht=Object.defineProperty;var fn=Object.getOwnPropertyDescriptor;var pn=Object.getOwnPropertyNames;var gn=Object.getPrototypeOf,mn=Object.prototype.hasOwnProperty;var F=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var yn=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of pn(t))!mn.call(e,r)&&r!==n&&Ht(e,r,{get:()=>t[r],enumerable:!(s=fn(t,r))||s.enumerable});return e};var tt=(e,t,n)=>(n=e!=null?dn(gn(e)):{},yn(t||!e||!e.__esModule?Ht(n,"default",{value:e,enumerable:!0}):n,e));var Sn=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var L=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)};var C=(e,t,n)=>(Sn(e,t,"access private method"),n);var H=F((Ao,Bt)=>{var bt=class{constructor(){this.array=[],this.keys=new Set,this.filter=null}get(t){return this.array[t]}size(){return this.array.length}push(t,n=null){if(this.filter!==null&&!this.filter(t,n))return;let s=n||t;this.keys.has(s)||(this.array.push(t),this.keys.add(s))}merge(t,n=[]){for(let s=0;s<t.length;s++)this.push(t[s],n[s])}toArray(){return[].concat(this.array)}};Bt.exports=bt});var Qt=F((Fo,Kt)=>{var _n={POLITE_PAST_NEGATIVE:0,POLITE_NEGATIVE:1,POLITE_VOLITIONAL:2,POLITE_PAST:3,CHAU:4,SUGIRU:5,NASAI:6,TARA:7,TARI:8,CAUSATIVE:9,POTENTIAL_OR_PASSIVE:10,SOU:11,TAI:12,POLITE:13,PAST:14,NEGATIVE:15,PASSIVE:16,BA:17,VOLITIONAL:18,POTENTIAL:19,PASSIVE_OR_CAUSATIVE:20,TE:21,ZU:22,IMPERATIVE:23,MASU_STEM:24,ADV:25,NOUN:26,IMPERATIVE_NEGATIVE:27,CHIMAU:28};Kt.exports=_n});var te=F((No,Zt)=>{var xt=class{constructor(t,n,s,r){this.inflectedWord=t,this.baseForm=n,this.form=s,this.inflectionType=r}toString(){return`${this.baseForm}, [${this.inflectionType}]`}};Zt.exports=xt});var ne=F((Oo,ee)=>{var Tt=class{constructor(t,n){let{map:s,maxLength:r}=this.createMap(t,n);this.map=s,this.maxLength=r}createMap(t,n){let s=0,r={};for(let o=0;o<t.length;o++){let i=t[o],a=n?i[n]:i,l=r[a];l||(l=[],r[a]=l),l.push(i),s<a.length&&(s=a.length)}return{map:r,maxLength:s}}search(t){let n=[],s=t.length<this.maxLength?t.length:this.maxLength;for(let r=s;r>=1;r--){let o=t.substring(t.length-r,t.length),i=this.map[o];i&&n.push(...i)}return n}find(t){let n=null,s=t.length<this.maxLength?t.length:this.maxLength;for(let r=s;r>=1;r--){let o=t.substring(t.length-r,t.length);if(this.map[o]){n=!0;break}}return n}};ee.exports=Tt});var re=F((Uo,se)=>{var zn={UNINFLECTABLE:0,GODAN:1,ICHIDAN:2,IKU:3,KURU:4,SURU:5,ADJECTIVE:6,KURERU:7,SPECIAL_RU:8,SPECIAL_ARU:9,SPECIAL:10};se.exports=zn});var ie=F((Mo,oe)=>{var Ct=Qt(),Rt=te(),jn=ne(),P=re(),Hn=H(),Bn=e=>{let t=Gn(e);return s=>qn(s,t).map(r=>r.baseForm)};oe.exports=Bn;var Pt=class{constructor(t,n,s){this.inflection=t,this.base=n,this.form=s}},Gn=e=>({adjective:k(e.adjective,"inflection"),ichidan:k(e.ichidan,"inflection"),godan:k(e.godan,"inflection"),suru:k(e.suru,"inflection"),kuru:k(e.kuru,"inflection"),special:k(e.special,"inflection"),iku:k(e.iku,"inflection"),bogus:k(e.bogus)}),k=(e,t)=>{let n=e.map(s=>new Pt(...s));return new jn(n,t)},qn=(e,t)=>{let n=new Hn;return n.push(new Rt(e,e,-1,-1)),At(n,t.adjective,P.ADJECTIVE,!0),At(n,t.ichidan,P.ICHIDAN,!0),At(n,t.godan,P.GODAN,!1),st(n,t.suru,P.SURU),st(n,t.kuru,P.KURU),st(n,t.special,P.SPECIAL),st(n,t.iku,P.IKU),Jn(n.array,t.bogus)},At=(e,t,n,s)=>{let r=e.size();for(let o=0;o<e.size()&&!(!s&&o>=r);o++){let i=e.get(o),a=t.search(i.baseForm);for(let l=0;l<a.length;l++){let c=a[l];if(i.inflectionType===P.ADJECTIVE&&!$n(c.form))continue;let h=Yn(i.baseForm,c);if(!h||n===P.ICHIDAN&&!Kn(h))continue;let u=new Rt(i.baseForm,h,c.form,n);e.push(u,h)}}},Vn=new Set([Ct.TAI,Ct.SOU,Ct.NEGATIVE]),$n=e=>Vn.has(e),Yn=(e,t)=>{if(!e.endsWith(t.inflection))return null;let n=e.length-t.inflection.length,s=e.substring(0,n)+t.base;return s.length<=1?null:s},st=(e,t,n)=>{let s=e.size();for(let r=0;r<s;r++){let o=e.get(r),i=t.search(o.baseForm);for(let a=0;a<i.length;a++){let l=i[a];if(l.inflection===o.baseForm){let c=l.base,h=new Rt(o.baseForm,c,l.form,n);e.push(h,c)}}}},Jn=(e,t)=>{let n=[];for(let s=0;s<e.length;s++){let r=e[s];if(r.baseForm===r.inflectedWord)continue;t.find(r.baseForm)||n.push(r)}return n},Xn=new Set(["\u3044","\u304D","\u304E","\u3057","\u3058","\u3061","\u3062","\u306B","\u3072","\u3073","\u3074","\u307F","\u308A","\u30A4","\u30AD","\u30AE","\u30B7","\u30B8","\u30C1","\u30C2","\u30CB","\u30D2","\u30D3","\u30D4","\u30DF","\u30EA","\u3048","\u3051","\u3052","\u305B","\u305C","\u3066","\u3067","\u306D","\u3078","\u3079","\u307A","\u3081","\u308C","\u30A8","\u30B1","\u30B2","\u30BB","\u30BC","\u30C6","\u30C7","\u30CD","\u30D8","\u30D9","\u30DA","\u30E1","\u30EC"]),Kn=e=>{let t=e.length;if(t<=1)return!1;let n=e.substring(t-2,t-1);return Xn.has(n)}});var le=F((_o,ae)=>{var Qn=ie();ae.exports=Qn});var et={ja:{continueProcessingPdf:`\u3053\u306EPDF\u30D5\u30A1\u30A4\u30EB\u3092\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u3057\u3001Mouse Dictionary\u306E\u5185\u90E8\u30D3\u30E5\u30FC\u30A2\u3067\u8868\u793A\u3057\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F
(\u8A2D\u5B9A\u753B\u9762\u3067\u3001\u3053\u306E\u78BA\u8A8D\u30C0\u30A4\u30A2\u30ED\u30B0\u8868\u793A\u3092\u30AA\u30D5\u306B\u3059\u308B\u3053\u3068\u3082\u3067\u304D\u307E\u3059)`,doesntSupportFrame:"Mouse Dictionary\u306F\u3001\u30D5\u30EC\u30FC\u30E0\u306E\u3042\u308B\u30DA\u30FC\u30B8\u3067\u4F7F\u7528\u3059\u308B\u3053\u3068\u306F\u3067\u304D\u307E\u305B\u3093\u3002",downloadingPdf:"\u{1F4D8}\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u4E2D...",preparingPdf:"\u{1F4D8}PDF\u30D3\u30E5\u30FC\u30A2\u6E96\u5099\u4E2D...",nonPdf:"PDF\u30D5\u30A1\u30A4\u30EB\u3067\u306F\u306A\u3044\u3088\u3046\u3067\u3059\u3002\u51E6\u7406\u3092\u4E2D\u65AD\u3057\u307E\u3057\u305F\u3002",cannotFetchLocalPdf:"\u26D4Mouse Dictionary\u306F\u30ED\u30FC\u30AB\u30EB\u306B\u3042\u308BPDF\u30D5\u30A1\u30A4\u30EB\u4E0A\u3067\u306F\u8D77\u52D5\u3067\u304D\u307E\u305B\u3093\u3002\u30AA\u30D7\u30B7\u30E7\u30F3\u753B\u9762\u304B\u3089\u958B\u3051\u308BPDF\u30D3\u30E5\u30FC\u30A2\u3092\u3054\u5229\u7528\u304F\u3060\u3055\u3044\u3002"},en:{continueProcessingPdf:`Are you sure you want to download this PDF file and view it using Mouse Dictionary's internal viewer?
(You can disable this confirmation by changing settings)`,doesntSupportFrame:"Mouse Dictionary doesn't support frame pages.",downloadingPdf:"\u{1F4D8}Downloading...",preparingPdf:"\u{1F4D8}Preparing PDF viewer...",nonPdf:"This is not a PDF document.",cannotFetchLocalPdf:"\u26D4Mouse Dictionary can't launch on local PDFs. Use the PDF viewer from the options screen."}};et.ja.needToPrepareDict="\u8F9E\u66F8\u30C7\u30FC\u30BF\u3092\u30ED\u30FC\u30C9\u3057\u3066\u304F\u3060\u3055\u3044(\u62E1\u5F35\u306E\u30A2\u30A4\u30B3\u30F3\u3092\u53F3\u30AF\u30EA\u30C3\u30AF\u2192\u300C\u30AA\u30D7\u30B7\u30E7\u30F3\u300D)",et.en.needToPrepareDict='Please load dictionary data first. Right click on the extension icon and select "Options"';var vn=()=>{let e="en",t=navigator.languages;if(!t)return e;let n=Object.keys(et);for(let s=0;s<t.length;s++){let r=t[s].toLowerCase().split("-")[0];if(n.includes(r)){e=r;break}}return e},A=e=>{var s;let t=vn();return(s=et[t][e])!=null?s:null};var En=async e=>{let t=chrome.runtime.getURL(e);return fetch(t).then(n=>n.json())},wn=(e,t)=>{for(let n=0;n<t.length;n++){let s=t[n];e.set(s[0],s[1])}},bn=(e,t,n)=>{let s={},r=n!=null?n:Object.keys(e);for(let o=0;o<r.length;o++){let i=r[o];s[i]=t?t(e[i]):null}return s},xn=(e,t)=>{let n=Object.keys(t),s=!0;for(let r=0;r<n.length;r++){let o=n[r];if(e[o]!==t[o]){s=!1;break}}return s},Tn=(e,t)=>t.x>=e.left&&t.x<=e.left+e.width&&t.y>=e.top&&t.y<=e.top+e.height,Cn=e=>{let t;return e==null||e===""?t=0:(t=parseInt(e,10),isNaN(t)&&(t=0)),t},An=e=>{let t={},n=Object.keys(e);for(let s=0;s<n.length;s++){let r=n[s],o=e[r];Number.isFinite(o)&&(t[r]=`${o}px`)}return t},Pn=(e,t=50,n=5)=>{let s=window.innerWidth,r=window.innerHeight;return{left:nt(e.left,n,s-e.width-n),top:nt(e.top,n,r-e.height-n),width:nt(e.width,t,s-n*2),height:nt(e.height,t,r-n*2)}},nt=(e,t,n)=>{let s=e;return s=Ln(s,n),s=Rn(s,t),s},Rn=(e,t)=>Number.isFinite(e)?Math.max(e,t):null,Ln=(e,t)=>Number.isFinite(e)?Math.min(e,t):null,In=()=>window.getSelection().toString().replace("\r"," ").replace(`
`," ").trim(),p={loadJson:En,updateMap:wn,omap:bn,areSame:xn,isInsideRange:Tn,convertToInt:Cn,convertToStyles:An,optimizeInitialPosition:Pn,getSelection:In};var Vt=tt(H());var I={},kn=/‑/g;I.dealWithHyphens=(e,t=qt)=>{let n=e.replace(kn,"-"),s="",r=0;for(;;){if(r>=n.length){s+=n.substring(r);break}let o=n.indexOf("-",r);if(o===-1||o===n.length-1){s+=n.substring(r);break}let i=!1;s+=n.substring(r,o);for(let a=o+1;a<n.length;a++){let l=n.charCodeAt(a);if(t(l)){a===o+1&&(s+="-"),r=a,i=!0;break}}i||(r=n.length)}return s};I.splitIntoWords=(e,t=qt)=>{let n=[],s=null,r=0;for(;;){let o=e.charCodeAt(r);if(t(o))s===null&&(s=r);else if(s!==null){let a=e.substring(s,r);n.push(a),s=null}if(r+=1,r>=e.length){if(s!==null){let a=e.substring(s);n.push(a)}break}}return n};var Gt=e=>{let t=[e],n=e.toLowerCase();return n!==e&&t.push(n),t};I.splitString=(e,t)=>{let n=[],s=0,r=0,o=!0;for(;r<e.length;){let i=e.charCodeAt(r),a=i>=65&&i<=90,l=null;i===35||i===45||i===46||i===95?(l=e.substring(s,r),s=r+1,o=!1):a&&!o&&s-r!==0?(l=e.substring(s,r),s=r,o=!1):o=a,l&&l.length>=t&&n.push(...Gt(l)),r+=1}if(s>0){let i=e.substring(s);i&&n.push(...Gt(i))}return n};I.replaceTrailingCharacters=(e,t,n)=>{let s=null;return e.endsWith(t)&&(s=e.substring(e,e.length-t.length)+n),s};I.tryToReplaceTrailingStrings=(e,t,n=3)=>{let s=[];for(let r=0;r<t.length;r++){let o=t[r];for(let i=0;i<o.length;i++){let a=o[i],l=I.replaceTrailingCharacters(e,a.search,a.new);if((l==null?void 0:l.length)>=n){s.push(l);break}}}return s};I.linkWords=(e,t=1,n=!0)=>{if(e.length===0)return[];let s=Dn(e[0]),r=e.slice(1),o=[],i=[];for(let a of s){a.push(...r);let{linkedWords:l,phraseProcessedWords:c}=Wn(a,t,n);o.push(...l.reverse()),i.push(...c)}return o.push(...i),o};var Wn=(e,t,n=!0)=>{let s=[],r=[],o=[];for(let i=0;i<e.length;i++){let a=e[i];if(o.push(a),i>=t-1&&(s.push(o.join(" ")),n)){let l=m.doPhrase(o).map(c=>c.join(" "));r.push(...l)}}return{linkedWords:s,phraseProcessedWords:r}},Dn=e=>{let t=[[e]],n=m.doBase(e);return n.length>=1&&t.push(...n.map(s=>[s])),t},qt=e=>e>=33&&e<=126,b=I;var $t=(e,t)=>{let n=new Vt.default,s=e.verb.get(t);s&&n.push(s);let r=e.noun.get(t);r&&n.push(r);let o=b.tryToReplaceTrailingStrings(t,e.trailing);return n.merge(o),n.toArray()};var Yt=(e,t)=>{let n=e[t.length];if(!n)return[];let s=[];for(let r=0;r<n.length;r++){let o=n[r],i=Nn(t,o);s.push(...i)}return s},Fn=new Set(["a","e","i","o","u","A","E","I","O","U"]),Nn=(e,t)=>{let n=[],s=0,r=[],o=!1;for(let i=0;i<t.length&&!(s>=e.length);i++){let a=t[i],{newWord:l,indexPlus:c}=On(a,e[s]);s+=c,a>0&&a<100&&r.push(n.length),l!==void 0&&(o&&Fn.has(l==null?void 0:l[0])&&(n[n.length-1]="an"),n.push(l),o=l==="a")}return r.length===0?[n]:Un(n,r)},On=(e,t)=>e===0?{newWord:t,indexPlus:1}:e===102?{newWord:"a",indexPlus:1}:e===103?{newWord:"a",indexPlus:0}:e===104&&t==="/"?{newWord:"and",indexPlus:1}:e===105&&t==="/"?{newWord:"or",indexPlus:1}:e>0&&e<100?{newWord:null,indexPlus:e}:e<0?{indexPlus:-e}:{indexPlus:0},Un=(e,t)=>{if(t.length===1){let n=[...e];return e[t[0]]="~",n[t[0]]="__",[e,n]}for(let n=0;n<t.length;n++){let s=t[n],r=65+n;e[s]=String.fromCharCode(r)}return[e]};var Jt=(e,t)=>{let n=[],s=!1;for(let r=0;r<e.length;r++){let o=[...t];for(let i=0;i<o.length;i++){let a=Mn(o[i],e[r]);a&&(o[i]=a,s=!0)}s&&n.push(o)}return n},Mn=(e,t)=>{let n=null,s=t.get(e);if(s)n=s;else{let r=e.charCodeAt(0);r>=65&&r<=90&&(e.endsWith("'s")||e.endsWith("s'"))&&(n=t.get("'s"))}return n};var Xt=(e,t)=>{let n=!1,s=[];for(let r=0;r<t.length;r++){let o=t[r],i=e.get(o);i?(n=!0,s.push(i)):s.push(o)}return n?s:null};var ce=tt(le()),he=new Map,ue=[],de=[],fe=new Map,pe=[],ge=new Map,me=new Map,ye=()=>{},Zn=e=>p.updateMap(me,e),ts=e=>p.updateMap(he,e),es=e=>Object.assign(ue,e),ns=e=>Object.assign(de,e.map(t=>new Map(t))),ss=e=>p.updateMap(fe,e),rs=e=>Object.assign(pe,e),os=e=>p.updateMap(ge,e),is=e=>{ye=(0,ce.default)(e)},as="data/rule.json",ls=async e=>{let t=p.loadJson(e);ve=()=>t;let n=await t;return Se(n),n},Se=e=>{let t=[{field:"letters",register:Zn},{field:"noun",register:ts},{field:"phrase",register:es},{field:"pronoun",register:ns},{field:"spelling",register:ss},{field:"trailing",register:rs},{field:"verb",register:os},{field:"ja",register:is}];for(let n=0;n<t.length;n++){let s=t[n],r=e[s.field];r&&s.register(r)}},ve=ls,cs=async(e=as)=>ve(e),m={load:cs,registerRuleData:Se,doBase:e=>$t({noun:he,trailing:pe,verb:ge},e),doLetters:e=>me.get(e),doPhrase:e=>Yt(ue,e),doPronoun:e=>Jt(de,e),doSpelling:e=>Xt(fe,e),doJa:e=>ye(e)};var hs=e=>window.getComputedStyle(e).cssText,us=(e,t,n)=>{let s=e.caretRangeFromPoint(t,n);return s?{node:s.startContainer,offset:s.startOffset}:null},B={getComputedCssText:hs,getCaretNodeAndOffsetFromPoint:us};var Jo={getComputedCssText:B.getComputedCssText,getCaretNodeAndOffsetFromPoint:B.getCaretNodeAndOffsetFromPoint};var Ee;Ee=B;var G=Ee;var ds=e=>{let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild},be=(e,t)=>{if(!(!t||typeof t!="object"))try{for(let n of Object.keys(t))e.style[n]=t[n]}catch(n){console.error(n)}},fs=(e,t)=>{e.innerHTML="",e.appendChild(t)},ps=4,we=10,gs=e=>{let t=[],n=e,s=n;for(let r=0;r<ps&&!(!n||n.tagName==="BODY");r++){let o=xe(n,s);if(t.push(...o),t.length>=we)break;s=n,n=n.parentNode}return ms(t.slice(0,we))},ms=e=>{let t=[],n=0;for(;!(n>=e.length);){let s=e[n];if(s==="-"){if(t.length===0){let r=e[n+1];t.push("-"+r)}else{let r=t.at(-1),o=e[n+1];t[t.length-1]=r+"-"+o}n+=2}else t.push(s),n+=1}return t.join(" ")},xe=(e,t)=>{let n=[];if(!e.childNodes||e.childNodes.length===0){if(e===t)return[];let r=e.textContent.trim();return r?[r]:[]}let s=ys(e,t);for(let r=0;r<s.length;r++){let o=xe(s[r]);n.push(...o)}return n},ys=(e,t)=>{if(!t)return e.childNodes;let n=[];for(let s=e.childNodes.length-1;s>=0;s--){let r=e.childNodes[s];if(r===t)break;n.push(r)}return n.reverse()},Ss=(e,t)=>{let n=t!=null?t:document.createElement(e.tagName);return n.style.cssText=G.getComputedCssText(e),n},vs=e=>e?e.endsWith("px")?parseFloat(e.slice(0,-2)):parseFloat(e):0,Lt=class{constructor(t){this.element=t,this.stagedStyles=new Map,this.appliedStyles=new Map}set(t,n){this.stagedStyles.get(t)!==n&&(this.stagedStyles.set(t,n),this.updateStyles())}apply(t){for(let[n,s]of Object.entries(t))this.stagedStyles.set(n,s);this.updateStyles()}updateStyles(){let t=this.getUpdatedData(this.stagedStyles,this.appliedStyles);if(t){be(this.element,t),this.stagedStyles=new Map;for(let[n,s]of Object.entries(t))this.appliedStyles.set(n,s)}}getUpdatedData(t,n){let s={},r=0;for(let[o,i]of t)i!==n.get(o)&&(s[o]=i,r+=1);return r===0?null:s}},f={create:ds,applyStyles:be,replace:fs,traverse:gs,clone:Ss,pxToFloat:vs,VirtualStyle:Lt};var Es=Object.prototype.toString,M=Array.isArray||function(t){return Es.call(t)==="[object Array]"};function kt(e){return typeof e=="function"}function ws(e){return M(e)?"array":typeof e}function It(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Te(e,t){return e!=null&&typeof e=="object"&&t in e}function bs(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var xs=RegExp.prototype.test;function Ts(e,t){return xs.call(e,t)}var Cs=/\S/;function As(e){return!Ts(Cs,e)}var Ps={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Rs(e){return String(e).replace(/[&<>"'`=\/]/g,function(n){return Ps[n]})}var Ls=/\s*/,Is=/\s+/,Ce=/\s*=/,ks=/\s*\}/,Ws=/#|\^|\/|>|\{|&|=|!/;function Ds(e,t){if(!e)return[];var n=!1,s=[],r=[],o=[],i=!1,a=!1,l="",c=0;function h(){if(i&&!a)for(;o.length;)delete r[o.pop()];else o=[];i=!1,a=!1}var u,d,y;function W(T){if(typeof T=="string"&&(T=T.split(Is,2)),!M(T)||T.length!==2)throw new Error("Invalid tags: "+T);u=new RegExp(It(T[0])+"\\s*"),d=new RegExp("\\s*"+It(T[1])),y=new RegExp("\\s*"+It("}"+T[1]))}W(t||w.tags);for(var g=new V(e),R,v,E,j,Z,D;!g.eos();){if(R=g.pos,E=g.scanUntil(u),E)for(var wt=0,un=E.length;wt<un;++wt)j=E.charAt(wt),As(j)?(o.push(r.length),l+=j):(a=!0,n=!0,l+=" "),r.push(["text",j,R,R+1]),R+=1,j===`
`&&(h(),l="",c=0,n=!1);if(!g.scan(u))break;if(i=!0,v=g.scan(Ws)||"name",g.scan(Ls),v==="="?(E=g.scanUntil(Ce),g.scan(Ce),g.scanUntil(d)):v==="{"?(E=g.scanUntil(y),g.scan(ks),g.scanUntil(d),v="&"):E=g.scanUntil(d),!g.scan(d))throw new Error("Unclosed tag at "+g.pos);if(v==">"?Z=[v,E,R,g.pos,l,c,n]:Z=[v,E,R,g.pos],c++,r.push(Z),v==="#"||v==="^")s.push(Z);else if(v==="/"){if(D=s.pop(),!D)throw new Error('Unopened section "'+E+'" at '+R);if(D[1]!==E)throw new Error('Unclosed section "'+D[1]+'" at '+R)}else v==="name"||v==="{"||v==="&"?a=!0:v==="="&&W(E)}if(h(),D=s.pop(),D)throw new Error('Unclosed section "'+D[1]+'" at '+g.pos);return Ns(Fs(r))}function Fs(e){for(var t=[],n,s,r=0,o=e.length;r<o;++r)n=e[r],n&&(n[0]==="text"&&s&&s[0]==="text"?(s[1]+=n[1],s[3]=n[3]):(t.push(n),s=n));return t}function Ns(e){for(var t=[],n=t,s=[],r,o,i=0,a=e.length;i<a;++i)switch(r=e[i],r[0]){case"#":case"^":n.push(r),s.push(r),n=r[4]=[];break;case"/":o=s.pop(),o[5]=r[2],n=s.length>0?s[s.length-1][4]:t;break;default:n.push(r)}return t}function V(e){this.string=e,this.tail=e,this.pos=0}V.prototype.eos=function(){return this.tail===""};V.prototype.scan=function(t){var n=this.tail.match(t);if(!n||n.index!==0)return"";var s=n[0];return this.tail=this.tail.substring(s.length),this.pos+=s.length,s};V.prototype.scanUntil=function(t){var n=this.tail.search(t),s;switch(n){case-1:s=this.tail,this.tail="";break;case 0:s="";break;default:s=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=s.length,s};function U(e,t){this.view=e,this.cache={".":this.view},this.parent=t}U.prototype.push=function(t){return new U(t,this)};U.prototype.lookup=function(t){var n=this.cache,s;if(n.hasOwnProperty(t))s=n[t];else{for(var r=this,o,i,a,l=!1;r;){if(t.indexOf(".")>0)for(o=r.view,i=t.split("."),a=0;o!=null&&a<i.length;)a===i.length-1&&(l=Te(o,i[a])||bs(o,i[a])),o=o[i[a++]];else o=r.view[t],l=Te(r.view,t);if(l){s=o;break}r=r.parent}n[t]=s}return kt(s)&&(s=s.call(this.view)),s};function S(){this.templateCache={_cache:{},set:function(t,n){this._cache[t]=n},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}S.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};S.prototype.parse=function(t,n){var s=this.templateCache,r=t+":"+(n||w.tags).join(":"),o=typeof s<"u",i=o?s.get(r):void 0;return i==null&&(i=Ds(t,n),o&&s.set(r,i)),i};S.prototype.render=function(t,n,s,r){var o=this.getConfigTags(r),i=this.parse(t,o),a=n instanceof U?n:new U(n,void 0);return this.renderTokens(i,a,s,t,r)};S.prototype.renderTokens=function(t,n,s,r,o){for(var i="",a,l,c,h=0,u=t.length;h<u;++h)c=void 0,a=t[h],l=a[0],l==="#"?c=this.renderSection(a,n,s,r,o):l==="^"?c=this.renderInverted(a,n,s,r,o):l===">"?c=this.renderPartial(a,n,s,o):l==="&"?c=this.unescapedValue(a,n):l==="name"?c=this.escapedValue(a,n,o):l==="text"&&(c=this.rawValue(a)),c!==void 0&&(i+=c);return i};S.prototype.renderSection=function(t,n,s,r,o){var i=this,a="",l=n.lookup(t[1]);function c(d){return i.render(d,n,s,o)}if(l){if(M(l))for(var h=0,u=l.length;h<u;++h)a+=this.renderTokens(t[4],n.push(l[h]),s,r,o);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")a+=this.renderTokens(t[4],n.push(l),s,r,o);else if(kt(l)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(n.view,r.slice(t[3],t[5]),c),l!=null&&(a+=l)}else a+=this.renderTokens(t[4],n,s,r,o);return a}};S.prototype.renderInverted=function(t,n,s,r,o){var i=n.lookup(t[1]);if(!i||M(i)&&i.length===0)return this.renderTokens(t[4],n,s,r,o)};S.prototype.indentPartial=function(t,n,s){for(var r=n.replace(/[^ \t]/g,""),o=t.split(`
`),i=0;i<o.length;i++)o[i].length&&(i>0||!s)&&(o[i]=r+o[i]);return o.join(`
`)};S.prototype.renderPartial=function(t,n,s,r){if(s){var o=this.getConfigTags(r),i=kt(s)?s(t[1]):s[t[1]];if(i!=null){var a=t[6],l=t[5],c=t[4],h=i;l==0&&c&&(h=this.indentPartial(i,c,a));var u=this.parse(h,o);return this.renderTokens(u,n,s,h,r)}}};S.prototype.unescapedValue=function(t,n){var s=n.lookup(t[1]);if(s!=null)return s};S.prototype.escapedValue=function(t,n,s){var r=this.getConfigEscape(s)||w.escape,o=n.lookup(t[1]);if(o!=null)return typeof o=="number"&&r===w.escape?String(o):r(o)};S.prototype.rawValue=function(t){return t[1]};S.prototype.getConfigTags=function(t){return M(t)?t:t&&typeof t=="object"?t.tags:void 0};S.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!M(t))return t.escape};var w={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){q.templateCache=e},get templateCache(){return q.templateCache}},q=new S;w.clearCache=function(){return q.clearCache()};w.parse=function(t,n){return q.parse(t,n)};w.render=function(t,n,s,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+ws(t)+'" was given as the first argument for mustache#render(template, view, partials)');return q.render(t,n,s,r)};w.escape=Rs;w.Scanner=V;w.Context=U;w.Writer=S;var Wt=w;var Os=e=>Wt.parse(e),Us=(e,t)=>Wt.render(e,t),_={parse:Os,render:Us};var Ms=e=>{let t=_.render(e.dialogTemplate,{backgroundColor:e.backgroundColor,width:e.width,height:e.height,scroll:"scroll"}),n=f.create(t);return f.applyStyles(n,e.normalDialogStyles),n},_s=e=>{let t=Ms(e),n=f.create(e.contentWrapperTemplate);return t.appendChild(n),{dialog:t,content:n}},Ae={create:_s};var Pe={get:(...e)=>chrome.storage.local.get(...e),set:(...e)=>chrome.storage.local.set(...e)},Re={get:(...e)=>chrome.storage.sync.get(...e),set:(...e)=>chrome.storage.sync.set(...e)},Le={get:async e=>$(Re.get,e),set:async e=>$(Re.set,e),async pick(e){let t=await Le.get([e]);return t==null?void 0:t[e]}},Ie={get:async e=>$(Pe.get,e),set:async e=>$(Pe.set,e),async pick(e){let t=await Ie.get([e]);return t==null?void 0:t[e]}},$=async(e,t)=>e?new Promise((n,s)=>{try{let r=o=>{chrome.runtime.lastError?s(chrome.runtime.lastError):n(o)};t?e(t,r):e(r)}catch(r){s(r)}}):null,N={local:Ie,sync:Le,doAsync:$};var Y={shortWordLength:2,cutShortWordDescription:30,parseWordsLimit:8,lookupWithCapitalized:!1,initialPosition:"right",skipPdfConfirmation:!1,pdfUrl:"",backgroundColor:"#ffffff",headFontColor:"#000088",descFontColor:"#101010",headFontSize:"medium",descFontSize:"small",width:350,height:500,replaceRules:[{search:"(\u25A0.+|\u25C6.+)",replace:'<span style="{{cssReset}};color:#008000;font-size:100%;">$1</span>'},{search:"({.+?}|\\[.+?\\]|\\(.+?\\))",replace:'<span style="{{cssReset}};color:#008000;font-size:100%;">$1</span>'},{search:"(\u3010.+?\u3011|\u300A.+?\u300B|\u3008.+?\u3009|\u3014.+?\u3015)",replace:'<span style="{{cssReset}};color:#008000;font-size:100%;">$1</span>'},{search:"\\n|\\\\n",replace:"<br/>"}],normalDialogStyles:`{
  "opacity": 0.95,
  "zIndex": 2147483647
}`,movingDialogStyles:`{
  "opacity": 0.6
}`,hiddenDialogStyles:`{
  "opacity": 0.0,
  "zIndex": -1
}`,contentWrapperTemplate:`<div style="margin:0;padding:0;border:0;vertical-align:baseline;text-align:left;">
</div>`,dialogTemplate:`<div class="notranslate"
     style="width: {{width}}px;
            height: {{height}}px;
            position: fixed;
            overflow-x: hidden;
            overflow-y: scroll;
            top: 5px;
            background-color: {{backgroundColor}};
            z-index: 2147483646;
            padding: 2px 4px 2px 4px;
            border: 1px solid #A0A0A0;">
</div>`,contentTemplate:`<div style="{{cssReset}};font-family:'hiragino kaku gothic pro', meiryo, sans-serif;">
  {{#words}}
    {{^isShort}}
      <span style="{{cssReset}};font-size:{{headFontSize}};color:{{headFontColor}};font-weight:bold;">
        {{head}}
      </span>
      <span style="cursor:pointer;visibility:hidden;" data-md-pronunciation="{{head}}" data-md-hovervisible="true">\u{1F50A}</span>
      <br/>
      <span style="{{cssReset}};font-size:{{descFontSize}};color:{{descFontColor}};">
        {{{desc}}}
      </span>
    {{/isShort}}
    {{#isShort}}
      <span style="{{cssReset}};font-size:{{headFontSize}};color:{{headFontColor}};font-weight:bold;">
        {{head}}
      </span>
      <span style="{{cssReset}};color:#505050;font-size:x-small;">
        {{shortDesc}}
      </span>
    {{/isShort}}
    {{^isLast}}
      <br/><hr style="border:0;border-top:1px solid #E0E0E0;margin:0;height:1px;width:100%;" />
    {{/isLast}}
  {{/words}}
</div>`};var zs={enableWindowStatusSave:!0,enableUserSettings:!0},z=zs;var rt="**** config ****",Dt="**** last_position ****",js="**** loaded ****",Hs=new Set(["normalDialogStyles","movingDialogStyles","hiddenDialogStyles"]),Bs=async()=>{if(!z.enableUserSettings)return{settings:ot(Y),position:{}};let e=await De([rt,Dt]),t={...Y,...e[rt]},n=ot(t),s=e[Dt];return{settings:n,position:s}},Gs=async()=>{let e=await ke();return ot(e)},ke=async()=>{if(!z.enableUserSettings)return{...Y};let t=(await De([rt]))[rt];return{...Y,...t}},ot=e=>{let t={},n=Object.keys(e);for(let s=0;s<n.length;s++){let r=n[s],o=e[r];o!=null&&(t[r]=Hs.has(r)?We(o):o)}return!z.enableWindowStatusSave&&e.initialPosition==="keep"&&(t.initialPosition="right"),t},We=e=>{if(!e)return null;let t;try{t=JSON.parse(e)}catch(n){t=null,console.error("Failed to parse json:"+e),console.error(n)}return t},qs=async e=>{if(!(!z.enableUserSettings||!z.enableWindowStatusSave))return N.sync.set({[Dt]:JSON.stringify(e)})},De=async e=>{var s,r;let t={},n=await N.sync.get(e);for(let o=0;o<e.length;o++){let i=e[o],a=(s=n[i])!=null?s:"{}";t[i]=(r=We(a))!=null?r:{}}return t},Vs=()=>N.local.pick(js),O={loadAll:Bs,loadSettings:Gs,loadRawSettings:ke,parseSettings:ot,savePosition:qs,isDataReady:Vs};var $s=(e,t)=>(n,s,r)=>{var l;let o=e(n);return{entries:((l=t[o])!=null?l:t.default)(n,s,r),lang:o}},Fe={build:$s};var Ne=tt(H());var Ys=new RegExp("\u200C","g"),Js=/[A-Za-z0-9]/g,Xs=e=>{let t=e.substring(0,40).replace(Ys,"").replace(Js,s=>String.fromCharCode(s.charCodeAt(0)+65248)),n=new Ne.default;for(let s=t.length;s>=1;s--){let r=t.substring(0,s);if(n.push(r),s>=2){let o=m.doJa(r);n.merge(o)}}return n.toArray()},Oe=Xs;var lt=tt(H());var Ks=new RegExp("\u200C","g"),Qs=new RegExp("/","g"),Zs=(e,t=!1,n=!1)=>{let s=e.replace(Ks,"").replace(Qs," / "),r=b.dealWithHyphens(s,m.doLetters),{firstWords:o,linkedWords:i}=er(r),a=new lt.default;a.filer=u=>u.length>=2||u===l,a.merge(i);let l=o==null?void 0:o[0];l&&a.merge(nr(l));let c=sr(o);c&&a.merge(c),t&&a.merge(a.toArray().map(u=>u.toUpperCase()));let h=tr(o);return a.merge(h),n&&!a.keys.has(e)?[e,...a.toArray()]:a.toArray()},tr=e=>{if(!((e==null?void 0:e.length)>=1))return[];let t=[],n=ze(e[0]);n.length>=2&&t.push(n);for(let s=1;!(s>=e.length||s>=6);s++){let r=e[s];n+=" "+ze(r),t.push(n)}return t},er=e=>{let t=[],n=e.toLowerCase(),s=n===e,r;if(s){let i=it(e);for(let a=0;a<i.length;a++)t.push(...at(i[a],!0));r=i[0]}else{let i=it(e);for(let l=0;l<i.length;l++)t.push(...at(i[l],!1));let a=it(n);for(let l=0;l<a.length;l++)t.push(...at(a[l],!0));r=a[0]}let o=ur(e);for(let i=0;i<o.length;i++){let a=it(o[i]);for(let l=0;l<a.length;l++)t.push(...at(a[l],!0))}return{firstWords:r,linkedWords:t}},nr=e=>[...or(e),...ir(e),...ar(e)],sr=e=>{if(!e)return null;if(e[1]==="/"&&e.length>=3){let t=e[0]+"/"+e[2];return[t,t.toLowerCase()]}return null},rr=["-",""," "],or=e=>{let t=e.split("-");if(t.length<=1)return[];let n=new lt.default,s=t[0],r=t.join("");n.push(r),n.push(r.toLowerCase());let o=m.doBase(s);for(let i of o){t[0]=i;for(let a of rr){let l=t.join(a);n.push(l),n.push(l.toLowerCase())}}return n.toArray()},ir=e=>{let t=[];for(let n=2;n<=e.length-2;n++){let s=e.slice(0,n),r=e.slice(n);t.push(s+" "+r),t.push(s+"-"+r)}return t},ar=e=>{let t=0,n=0,s=-1,r=-1;for(let l=0;l<e.length;l++){let c=e.charCodeAt(l);if(c===t)n++;else if(n<3)t=c,n=1,s=l;else{r=l,n=0;break}}if(n>=3&&(r=e.length),s===-1||r===-1)return[];let o=e.substring(0,s),i=String.fromCharCode(t),a=e.substring(r);return[o+i+a,o+i+i+a]},Ue=e=>m.doLetters(e),it=e=>{if(!e)return[];let t=[],n=lr(e);n>=2&&t.push(b.splitIntoWords(e.substring(0,n),Ue));let s=b.splitIntoWords(e,Ue);t.push(s);let r=m.doSpelling(s);return r&&t.push(r),t},lr=e=>{let t=-1;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);if(s===44||s===46){t=n;break}}return t},at=(e,t)=>{let n=[],s=Me(e,t,1);n.push(...s);let r=e.length>=2?m.doPronoun(e):[];for(let o of r)if(o){let i=Me(o,t,2);n.push(...i)}return e.length>=2&&n.push(e[0]+e[1]),n},je=[[{search:"'s",new:""},{search:"s",new:""}],[{search:"er",new:""}],[{search:"iest",new:"y"}],[{search:"est",new:""}]],Me=(e,t,n=1)=>{let s=t,r=t,o=b.linkWords(e,n,s);if(n<=1){let a=cr(e[0],r);o.push(...a)}let i=[];for(let a=0;a<o.length;a++){let l=b.tryToReplaceTrailingStrings(o[a],je);i.push(...l)}return o.push(...i),o},cr=(e,t,n=3)=>{if(!e)return[];let s=new lt.default;s.filer=o=>o.length>=n;let r;if(t)r=[e];else{let o=e.toLowerCase();r=o===e?[e]:[e,o]}for(let o=0;o<r.length;o++){let i=r[o];o>=1&&s.push(i),s.merge(b.tryToReplaceTrailingStrings(i,je));let a=b.splitString(i,2);a.length>=2&&s.push(a.join(" ")),s.merge(a);let l=a.map(m.doBase);for(let c=0;c<l.length;c++)s.merge(l[c]);if(a.length>=2){let c=a[0];_e(e,c.length)&&s.push(c+"-");let h=a.at(-1);_e(e,e.length-h.length-1)&&s.push("-"+h)}}return s.toArray()},_e=(e,t)=>{let n=e.charCodeAt(t);return n===45||n===8209},hr=['"',"'"],ur=e=>{let t=[];for(let n of hr){let s=e.indexOf(n,1);if(s>=3){let r=e.startsWith(n)?1:0,o=e.substring(r,s);t.push(o);let i=o.toLowerCase();i!==o&&t.push(i)}}return t},ze=e=>e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),Ft=Zs;var dr={en:Ft,ja:Oe,default:Ft},fr=e=>pr(e)?"en":"ja",pr=e=>{let t=!0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);if(!(32<=s&&s<=126||s===8209||s===8204)){t=!1;break}}return t},gr=()=>Fe.build(fr,dr),He=gr;var ct,Be,ht,Ge,ut,qe,J=class{constructor(t){L(this,ct);L(this,ht);L(this,ut);this.shortWordLength=t.shortWordLength,this.cutShortWordDescription=t.cutShortWordDescription;let n="margin:0;padding:0;border:0;vertical-align:baseline;line-height:normal;text-shadow:none;";this.baseParameters={headFontColor:t.headFontColor,descFontColor:t.descFontColor,headFontSize:t.headFontSize,descFontSize:t.descFontSize,cssReset:n},this.scroll=t.scroll,this.compiledReplaceRules=mr(t.replaceRules,{cssReset:n}),this.contentTemplate=t.contentTemplate,_.parse(t.contentTemplate)}generate(t,n,s=!0){let r=C(this,ct,Be).call(this,t,n,s),o=Object.keys(n).length;return{html:r,hitCount:o}}};ct=new WeakSet,Be=function(t,n,s){let r={...this.baseParameters,words:C(this,ut,qe).call(this,t,n,s)};return _.render(this.contentTemplate,r)},ht=new WeakSet,Ge=function(t){let n=t;for(let s=0;s<this.compiledReplaceRules.length;s++){let r=this.compiledReplaceRules[s];n=n.replace(r.search,r.replace)}return n},ut=new WeakSet,qe=function(t,n,s){let r=[],o=s?this.shortWordLength:0;for(let i=0;i<t.length;i++){let a=t[i],l=n[a];if(typeof l!="string")continue;let c=a.length<=o,h=a.length<=this.shortWordLength;r.push({head:Er(a),desc:C(this,ht,Ge).call(this,l),isShort:c,isShortWord:h,shortDesc:l.substring(0,this.cutShortWordDescription),isFirst:!1,isLast:!1})}return r.length>=1&&(r[0].isFirst=!0,r[0].isShort=!1,r[r.length-1].isLast=!0),r};var mr=(e,t)=>{let n=[];for(let s=0;s<e.length;s++){let r=yr(e[s],t);r&&n.push(r)}return n},yr=(e,t)=>{if(!e.search)return null;let n=null;try{n=new RegExp(e.search,"g")}catch(r){console.error(r)}if(!n)return null;let s=_.render(e.replace,t);return{search:n,replace:s}},Sr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},vr=/&|<|>|"/g,Er=e=>e.replace(vr,t=>Sr[t]);var Nt=class{constructor(t){this.size=t,this.list=wr(t,""),this.dict=new Map,this.index=0}put(t,n){if(this.get(t))return;let s=this.list[this.index];if(s){let r=s.key;this.dict.delete(r)}else s={},this.list[this.index]=s;s.key=t,s.value=n,this.dict.set(t,this.index),this.index=(this.index+1)%this.size}get(t){if(!t)return null;let n=this.dict.get(t);return isFinite(n)?this.list[n].value:null}},wr=(e,t)=>{let n=[];for(let s=0;s<e;s++)n.push(t);return n},Ve=Nt;var br=128,dt,$e,K,Ot,ft,Ye,X=class{constructor(t,n,s){L(this,dt);L(this,K);L(this,ft);this.lookupWithCapitalized=t.lookupWithCapitalized,this.doUpdateContent=s,this.doBuildEntry=n,this.lastText=null,this.aimed=!1,this.suspended=!1,this.halfLocked=!1,this.textLengthLimit=br,this.counter=0,this.generator=new J(t);let r=100;this.shortCache=new Ve(r),String.prototype.matchAll&&(this.reForReferences=/[→＝]([- A-z']+)/g)}async lookup(t){return this.lookupAll([t])}async lookupAll(t){return C(this,dt,$e).call(this)?await C(this,K,Ot).call(this,t,this.lookupWithCapitalized,!1,!0,0):!1}async aimedLookup(t){return t?this.lastText===t?!1:(this.aimed=!0,await this.update(t,!0,!0,!1,1)):(this.aimed=!1,!1)}async update(t,n,s,r,o=0){return t?await C(this,K,Ot).call(this,[t],n,s,r,o):!1}async run(t,n,s,r){return this.runAll([t],n,s,r)}async runAll(t,n,s,r){let o=[],i=[];for(let u=0;u<t.length;u++){let d=t[u],{entries:y,lang:W}=this.doBuildEntry(d,n,s);o.push(...y),i.push(W)}let{heads:a,descriptions:l}=await xr(o,this.reForReferences),{html:c,hitCount:h}=this.generator.generate(a,l,r&&i[0]==="en");return{html:c,hit:h}}};dt=new WeakSet,$e=function(){return!(this.suspended||this.halfLocked&&this.aimed||!this.halfLocked&&p.getSelection())},K=new WeakSet,Ot=async function(t,n,s,r,o=0){let{content:i,hit:a}=await C(this,ft,Ye).call(this,t,n,s,r);return a>=o?(this.doUpdateContent(i,a),!0):!1},ft=new WeakSet,Ye=async function(t,n,s,r){let o=[];for(let u=0;u<t.length;u++){let d=t[u].substring(0,this.textLengthLimit);d&&o.push(d)}let i=o.join("");if(!s){if(this.lastText===i)return{};let u=this.shortCache.get(i);if(u)return this.doUpdateContent(u.dom,u.hitCount),this.lastText=i,{}}let a=++this.counter,{html:l,hit:c}=await this.runAll(o,n,s,r),h=f.create(l);return this.lastText=i,{content:h,hit:c}};var xr=async(e,t)=>{let n=await N.local.get(e),s=e.filter(l=>n[l]),r=Tr(n,t);if(r.length===0)return{heads:s,descriptions:n};let o=await N.local.get(r),i=[...s,...r],a={...n,...o};return{heads:i,descriptions:a}},Tr=(e,t)=>{let n=new Set;if(!t)return n;let s=new Set(Object.keys(e)),r=Object.values(e);for(let o=0;o<r.length;o++){let i=r[o],a=Cr(i,t);for(let l=0;l<a.length;l++){let c=a[l];s.has(c)||n.add(c)}}return Array.from(n)},Cr=(e,t)=>{let n=[],s=e.matchAll(t);for(let r of s)n.push(r[1]);return n};var Ar=e=>new Ut(e),Pr=new Set(["INPUT","TEXTAREA","SELECT","OPTION"]),Rr={position:"absolute",zIndex:2147483647,opacity:0},Lr={INPUT:{overflow:"hidden",whiteSpace:"nowrap"},TEXTAREA:{overflow:"hidden"},SELECT:{overflow:"hidden",whiteSpace:"nowrap"},OPTION:{overflow:"hidden",whiteSpace:"nowrap"}},Ir=["fontSize","fontWeight","fontFamily","lineHeight","paddingTop","paddingRight","paddingBottom","paddingLeft"],Ut=class{constructor(t){this.elementCache=kr(t),this.decoy=null}activate(t){if(!this.elementCache||!Pr.has(t.tagName))return;let n=Wr(f.clone(t,this.elementCache),t);document.body.appendChild(n),this.decoy=n,n.scrollTop=t.scrollTop,n.scrollLeft=t.scrollLeft;let s=t.clientWidth-n.clientWidth,r=t.clientHeight-n.clientHeight,o=getComputedStyle(t),i={};for(let a of Ir)i[a]=o[a];i.width=`${t.clientWidth+s}px`,i.height=`${t.clientHeight+r}px`,f.applyStyles(n,i)}deactivate(){if(!this.elementCache)return;let t=this.decoy;this.decoy=null,t&&document.body.removeChild(t)}},kr=e=>e?document.createElement(e):null,Wr=(e,t)=>{e.innerText=Dr(t);let n=Nr(e,t);n.width=`${t.clientWidth}px`,n.height=`${t.clientHeight}px`,f.applyStyles(e,n);for(let s of["min-width","min-height","max-width","max-height"])e.style.removeProperty(s);return e},Dr=e=>{var t;return e.tagName==="SELECT"?Fr(e):(t=e.text)!=null?t:e.value};function Fr(e){var n;var t=e.selectedIndex;return(n=e.options[t])==null?void 0:n.text}var Nr=(e,t)=>{let n=Or(t),s=n.top-f.pxToFloat(e.style.marginTop),r=n.left-f.pxToFloat(e.style.marginLeft);return{...{top:`${s}px`,left:`${r}px`},...Rr,...Lr[t.tagName]}},Or=e=>{let t=e.getBoundingClientRect(),n=document.documentElement;return{top:t.top+window.pageYOffset-n.clientTop,left:t.left+window.pageXOffset-n.clientLeft}},Je={create:Ar};var Ur=(e,t)=>{let n=new Mt(e,t);return(r,o,i)=>{let a;try{a=n.fetchTextUnderCursor(r,o,i)}catch(l){console.error(l)}return a!=null?a:[]}},Mt=class{constructor(t,n){this.JA_MAX_LENGTH=40,this.getTargetCharacterType=t!=null?t:s=>Ke(s)?3:0,this.maxWords=n!=null?n:8,this.decoy=Je.create("div")}fetchTextUnderCursor(t,n,s){let r=G.getCaretNodeAndOffsetFromPoint(t.ownerDocument,n,s);if(!r)return[];let{node:o,offset:i}=r;return o.nodeType===Node.TEXT_NODE?this.fetchTextFromTextNode(o,i):o.nodeType===Node.ELEMENT_NODE?this.fetchTextFromElementNode(t,n,s):[]}fetchTextFromTextNode(t,n){let{text:s,subText:r,end:o,isEnglish:i}=this.getTextFromRange(t.data,n),a=r?[s,r]:[s];if(!o)return a;let l=f.traverse(t);return a.map(c=>this.concatenate(c,l,i))}concatenate(t,n,s){let r=zr(t,n,s),o=s?Xe(r,0,this.maxWords,this.getTargetCharacterType):this.JA_MAX_LENGTH;return r.substring(0,o)}fetchTextFromElementNode(t,n,s){try{this.decoy.activate(t);let r=G.getCaretNodeAndOffsetFromPoint(t.ownerDocument,n,s);if(!r)return;let{node:o,offset:i}=r;if(o.nodeType===Node.TEXT_NODE)return this.fetchTextFromTextNode(o,i,this.maxWords)}finally{this.decoy.deactivate()}}getTextFromRange(t,n){if(!t)return{};let s=t.charCodeAt(n),r=Ke(s),o,i,a,l;if(r)o=_r(t,n,this.getTargetCharacterType),i=Xe(t,n,this.maxWords,this.getTargetCharacterType),a=t.substring(o,i);else{o=n,i=n+this.JA_MAX_LENGTH;let h=Mr(t,o+1);a=t.substring(h,i),o!==h&&(l=t.substring(o,i))}let c=i>=t.length;return{text:a,subText:l,end:c,isEnglish:r}}},Mr=(e,t)=>{let n=0,s=jr(e,"ja-JP");if(!s)return t;for(let r=0;r<s.length;r++){let o=s[r];if(t<=n+o.length)return n;n+=o.length}return 0},_r=(e,t,n)=>{let s,r=t;for(;;){let o=e.charCodeAt(r);if(!(n(o)&1)){s=r+1;break}if(r<=0){s=0;break}r-=1}return s},Xe=(e,t,n,s)=>{let r,o=t+1,i=0,a=!1;for(;;){let l=e.charCodeAt(o);if(l===32){if(a||(i+=1),a=!0,i>=n){r=o;break}}else{if(!(s(l)&2)){r=o;break}a=!1}if(o>=e.length){r=o;break}o+=1}return r},zr=(e,t,n)=>t?!n||t.startsWith("-")?e+t:e+" "+t:e,Ke=e=>32<=e&&e<=126,jr=(e,t)=>{if(!(Intl!=null&&Intl.v8BreakIterator))return null;let n=Intl.v8BreakIterator([t],{type:"word"});n.adoptText(e);let s=0,r=[];for(;s<e.length;){let o=s;s=n.next(),r.push(e.substring(o,s))}return r},Qe={build:Ur};var gt=1,mt=2,yt=4,St=8,Ze=gt|mt|yt|St,tn=16,Hr={near:gt,far:yt},Br={near:St,far:mt},Gr=["move","ns-resize","ew-resize","nesw-resize","ns-resize","move","nwse-resize","move","ew-resize","nwse-resize","move","move","nesw-resize","move","move","move","move"],_t=class{constructor(t){this.gripWidth=t.gripWidth}getEdgeState(t,n,s){if(isNaN(n)||isNaN(s))return 0;let r=0;return pt(t.left,n,t.left+this.gripWidth)?r|=St:pt(t.left+t.width-this.gripWidth,n,t.left+t.width)&&(r|=mt),pt(t.top,s,t.top+this.gripWidth)?r|=gt:pt(t.top+t.height-this.gripWidth,s,t.top+t.height)&&(r|=yt),(r!==0||p.isInsideRange(t,{x:n,y:s}))&&(r|=tn),r}getCursorStyle(t){return Gr[t&Ze]}},qr=e=>new _t(e),pt=(e,t,n)=>e<=t&&t<=n,zt=class{constructor(t,n,s){this.square=t,this.edgeState=n,this.minimumLength=s}move(t,n){return{left:this.square.left+t,top:this.square.top+n}}resize(t,n){let s={left:null,top:null,width:null,height:null},r=this.calculate1dPosition(Hr,this.square.top,this.square.height,n);s.top=r.position,s.height=r.length;let o=this.calculate1dPosition(Br,this.square.left,this.square.width,t);return s.left=o.position,s.width=o.length,s}calculate1dPosition(t,n,s,r){if(this.edgeState&t.near){let o=Math.max(s-r,this.minimumLength);return{position:n+s-o,length:o}}return this.edgeState&t.far?{position:null,length:Math.max(s+r,this.minimumLength)}:{}}},Vr=(e,t,n)=>new zt(e,t,n),x={build:qr,createSquare:Vr,TOP:gt,RIGHT:mt,BOTTOM:yt,LEFT:St,EDGE:Ze,INSIDE:tn};var $r="position:fixed;background-color:#4169e1;opacity:0.20;z-index:2147483646;",jt=class{constructor(){this.initialized=!1,this.activated=!1,this.minArea=300*300,this.minSide=90,this.isElementPresent=!1}initialize(){this.initialized||(this.snapElement=f.create(`<div style="${$r};"></div>`),this.initialized=!0)}appendElement(){this.isElementPresent||(document.body.appendChild(this.snapElement),this.isElementPresent=!0)}removeElement(){this.isElementPresent&&(this.snapElement.remove(),this.isElementPresent=!1)}update(t,n,s,r){let o=this.fetchSnapRange(t,n,s,r);o&&(this.lastRange=o,this.initialized&&this.transform(o))}transform(t){let n={left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`,height:`${t.height}px`};f.applyStyles(this.snapElement,n)}activate(){this.initialize(),this.appendElement(),this.activated=!0}deactivate(){this.removeElement(),this.activated=!1}getRange(){return this.lastRange?{...this.lastRange}:null}fetchSnapRange(t,n,s,r){if(s.left<0){let i=Math.min(r,window.innerWidth/2),a=window.innerHeight-6;return{left:0,top:0,width:i,height:a}}if(s.left+s.width>window.innerWidth){let i=Math.min(r,window.innerWidth/2),a=window.innerHeight-6;return{left:document.documentElement.clientWidth-i,top:0,width:i,height:a}}let o=document.elementsFromPoint(t,n);return this.selectSnapElementRange(o)}selectSnapElementRange(t){for(let n=1;n<t.length;n++){let s=t[n];if(this.isExceptionalElement(s))continue;let r=Yr(s.getBoundingClientRect());if(this.isEligibleElement(r))return r}return null}isExceptionalElement(t){if(t===this.snapElement)return!0;let n=t.tagName;return n==="BODY"||n==="HTML"}isEligibleElement(t){if(t.width<this.minSide||t.height<this.minSide)return!1;let n=t.width*t.height,s=window.innerWidth*window.innerHeight;return!(n<this.minArea||n>s/2)}isActivated(){return this.activated}},Yr=e=>({left:e.left,top:e.top,width:Math.min(e.width,window.innerWidth),height:Math.min(e.height,window.innerHeight)}),Jr=()=>new jt,en={build:Jr};var Xr=0,vt=1,nn=2,Et=5,Kr=50,sn=["left","top","width","height"],Q=class{constructor(t,n){this.normalStyles=t,this.movingStyles=n,this.mainElement=null,this.mainElementStyle=null,this.current={left:null,top:null,width:null,height:null},this.last={left:null,top:null,width:null,height:null},this.edge=x.build({gripWidth:20}),this.edgeState=0,this.selectable=!1,this.initialize(),this.mouseMoveFunctions=[this.updateEdgeState,this.move,this.resize],this.snap=en.build(),this.enableSnap=!1,this.guide=null,this.events={change:()=>{},move:()=>{},resize:()=>{},finish:()=>{}}}initialize(){this.starting={x:null,y:null},this.changingSquare=null,this.mode=Xr}onMouseMove(t,n){this.mouseMoveFunctions[this.mode].call(this,t,n)}onMouseUp(t){this.mode===vt&&this.mainElementStyle.apply(this.normalStyles),this.finishChanging(t),this.snap.deactivate()}finishChanging(){this.snap.isActivated()&&this.snapElement(),this.initialize(),this.callOnChange(),this.events.finish()}snapElement(){let t=this.snap.getRange();t&&(this.transform(t),this.mainElementStyle.apply(this.normalStyles))}updateEdgeState(t){let n=this.edge.getEdgeState(this.current,t.x,t.y);if(!this.selectable){this.edgeState=n,this.mainElementStyle.set("cursor",this.edge.getCursorStyle(this.edgeState));return}n&x.INSIDE?(this.edgeState=0,this.mainElementStyle.set("cursor","text")):(this.selectable=!1,this.mainElementStyle.set("cursor","move"))}move(t){let[n,s]=this.moved(t),r=this.changingSquare.move(n,s);if(p.areSame(this.current,r))return;this.transform(r),this.events.move(),this.enableSnap&&this.snap.activate();let o=p.omap(this.mainElement.style,p.convertToInt,sn);this.snap.update(t.clientX,t.clientY,o,this.mainElement.clientWidth),this.mainElementStyle.apply(this.movingStyles)}transform(t){for(let n of Object.keys(t))this.applyNewStyle(t,n)}resize(t){let[n,s]=this.moved(t),r=this.changingSquare.resize(n,s);this.transform(r),this.events.resize()}moved(t){return[p.convertToInt(t.pageX)-this.starting.x,p.convertToInt(t.pageY)-this.starting.y]}applyNewStyle(t,n){let s=this.current[n],r=t[n];Number.isFinite(r)&&r!==s&&(this.current[n]=r,this.mainElement.style[n]=`${r}px`)}callOnChange(){p.areSame(this.current,this.last)||(this.events.change({...this.current}),Object.assign(this.last,this.current))}add(t){this.mainElement=t,this.mainElementStyle=new f.VirtualStyle(t),this.makeElementDraggable(t),this.current.width=t.clientWidth,this.current.height=t.clientHeight,this.mainElement.addEventListener("click",()=>{this.current.width=this.mainElement.clientWidth,this.current.height=this.mainElement.clientHeight})}makeElementDraggable(t){t.addEventListener("dblclick",n=>this.handleDoubleClick(n)),t.addEventListener("mousedown",n=>this.handleMouseDown(n)),this.mainElementStyle.set("cursor","move"),this.current.left=p.convertToInt(t.style.left),this.current.top=p.convertToInt(t.style.top)}handleDoubleClick(t){if(this.selectable)return;let n=this.edge.getEdgeState(this.current,t.x,t.y);if(n===x.INSIDE){this.selectable=!0,this.mainElementStyle.set("cursor","text");return}this.jump(n),this.finishChanging()}jump(t){let n={};t&x.LEFT?n.left=Et:t&x.RIGHT&&(n.left=document.documentElement.clientWidth-this.mainElement.clientWidth-Et),t&x.TOP?n.top=Et:t&x.BOTTOM&&(n.top=window.innerHeight-this.mainElement.clientHeight-Et),this.transform(n)}handleMouseDown(t){if(this.selectable)return;this.mode=this.edgeState&x.EDGE?nn:vt,this.starting.x=p.convertToInt(t.pageX),this.starting.y=p.convertToInt(t.pageY);let n=p.omap(this.mainElement.style,p.convertToInt,sn);this.changingSquare=x.createSquare(n,this.edgeState,Kr),t.preventDefault(),this.mode===nn&&this.events.resize(),this.mode===vt&&this.events.move()}activateSnap(){this.mode===vt&&this.snap.activate(),this.enableSnap=!0}deactivateSnap(){this.snap.deactivate(),this.enableSnap=!1}scroll(t){this.mainElement.scrollTop+=t}resetScroll(){this.mainElement.scrollTop=0}};var Qr=e=>{if(!e)return;let t=new SpeechSynthesisUtterance(e);Zr(e.charCodeAt(0))?t.lang="en-US":t.lang="ja-JP",speechSynthesis.speak(t)},Zr=e=>32<=e&&e<=126,rn={pronounce:Qr};var to=["left","top","width","height"],eo=async(e,t,n)=>{let s=!0,r=Qe.build(m.doLetters,e.parseWordsLimit),o=new X(e,He(),n),i=new Q(e.normalDialogStyles,e.movingDialogStyles);i.events.change=d=>O.savePosition(d),i.add(t),no(t),document.body.addEventListener("mousedown",()=>{o.suspended=!0}),document.body.addEventListener("mouseup",async d=>{i.onMouseUp(d),o.suspended=!1,await o.aimedLookup(p.getSelection())&&i.resetScroll();let W=p.omap(t.style,p.convertToInt,to),g=p.isInsideRange(W,{x:d.clientX,y:d.clientY});o.halfLocked=g});let a=async d=>{await m.load(),c=l,c(d)},l=async d=>{if(i.onMouseMove(d),s){let y=r(d.target,d.clientX,d.clientY);await o.lookupAll(y)&&i.resetScroll()}},c=a;document.body.addEventListener("mousemove",d=>c(d)),document.body.addEventListener("keydown",d=>{d.key==="Shift"&&i.activateSnap(d)}),document.body.addEventListener("keyup",d=>{d.key==="Shift"&&i.deactivateSnap(d)}),chrome.runtime.onMessage.addListener(d=>{let y=d.message;switch(y==null?void 0:y.type){case"text":o.update(y.text,y.withCapitalized,y.mustIncludeOriginalText,y.enableShortWord);break;case"mousemove":i.onMouseMove(y);break;case"mouseup":i.onMouseUp();break;case"enable_default":s=!0;break;case"disable_default":s=!1;break;case"scroll_up":i.scroll(-50);break;case"scroll_down":i.scroll(50);break}});let h=p.getSelection();h&&(await m.load(),o.aimedLookup(h));let u=null;i.events.move=()=>{u||(u=so(),t.appendChild(u))},i.events.finish=()=>{u&&(u.remove(),u=null)}},no=e=>{e.addEventListener("mouseenter",t=>{t.target.querySelectorAll("[data-md-pronunciation]").forEach(n=>{n.dataset.mdPronunciationSet||(n.dataset.mdPronunciationSet="true",n.addEventListener("click",()=>rn.pronounce(n.dataset.mdPronunciation)))}),t.target.querySelectorAll("[data-md-hovervisible]").forEach(n=>{n.style.visibility="visible"})}),e.addEventListener("mouseleave",t=>{t.target.querySelectorAll("[data-md-hovervisible]").forEach(n=>{n.style.visibility="hidden"})})},so=()=>{let e=f.create("<div>Shift+Move: Smart-snap</div>");return f.applyStyles(e,{right:"0px",top:"0px",position:"absolute",color:"#FFFFFF",backgroundColor:"#4169e1",fontSize:"small",opacity:"0.90",margin:"4px",padding:"3px",borderRadius:"5px 5px 5px 5px"}),e},on={attach:eo};var ro=["\u283F","\u283F","\u283F","\u2837","\u282F","\u281F","\u283B","\u283D","\u283E"],oo="position:absolute;width:100%;bottom:0;background-color:black;opacity:0.90;text-align:center;font-size:x-large;color:#FFFFFF",io=(e="")=>{let t=f.create(`<div style="${oo};${e}"></div>`),n=f.create('<span style=""></span>'),s=f.create('<span style="position:absolute;text-align:center;"></span>'),r=[...ro],o=0,i=setInterval(()=>{s.textContent=r[o%r.length],o++},150);return t.appendChild(n),t.appendChild(s),document.body.appendChild(t),[(c,h)=>{n.textContent=c,h&&(r=h)},()=>{t.parentNode.removeChild(t),clearInterval(i)}]},an={create:io};var ao=async()=>{let[e,t]=an.create();e(A("downloadingPdf"));let n;try{n=await fetch(location.href)}catch(o){location.href.startsWith("file://")?e(A("cannotFetchLocalPdf"),[""]):e(o.message,[""]);return}if(n.status!==200){e(await n.text(),[""]);return}e(A("preparingPdf"));let s=await n.arrayBuffer();if(!lo(s)){e(A("nonPdf"),[""]);return}let r=co(s);ho({type:"open_pdf",payload:r}),t()},lo=e=>{let t=new Uint8Array(e.slice(0,4));return t[0]===37&&t[1]===80&&t[2]===68&&t[3]===70},co=e=>{let t="",n=new Uint8Array(e);for(let s=0;!(s*1023>=n.length);s++){let r=s*1023,o=(s+1)*1023,i=n.slice(r,o),a=btoa(String.fromCharCode(...i));t+=a}return t},ho=async e=>new Promise(t=>{chrome.runtime.sendMessage(e,n=>{t(n)})}),ln={invoke:ao};var hn=async()=>{let e=document.getElementById("____MOUSE_DICTIONARY_6FQSXRIXUKBSIBEF_1.6.7");e?await go(e):await uo()},uo=async()=>{if(mo()){alert(A("doesntSupportFrame"));return}let{settings:e,position:t}=await O.loadAll();if(po(location.href,e.pdfUrl)){fo(e);return}try{So(e,t)}catch(n){alert(n.message),console.error(n);return}m.load()},fo=e=>{if(e.skipPdfConfirmation||confirm(A("continueProcessingPdf")))try{ln.invoke()}catch(n){alert(n.message),console.error(n)}},po=(e,t)=>{var n,s;if(!t){let r=(s=(n=document.body)==null?void 0:n.children)==null?void 0:s[0];return(r==null?void 0:r.tagName)==="EMBED"&&(r==null?void 0:r.type)==="application/pdf"}try{return new RegExp(t).test(e)}catch(r){console.error(r)}return!1},go=async e=>{let t=await O.loadSettings();yo(e,t)},mo=()=>{let e=document.getElementsByTagName("frame");return(e==null?void 0:e.length)>=1},yo=(e,t)=>{e.getAttribute("data-mouse-dictionary-hidden")==="true"?(f.applyStyles(e,t.normalDialogStyles),e.setAttribute("data-mouse-dictionary-hidden","false")):(f.applyStyles(e,t.hiddenDialogStyles),e.setAttribute("data-mouse-dictionary-hidden","true"))},So=(e,t)=>{let n=Ae.create(e);n.dialog.id="____MOUSE_DICTIONARY_6FQSXRIXUKBSIBEF_1.6.7",f.applyStyles(n.dialog,e.hiddenDialogStyles),document.body.appendChild(n.dialog);let s=vo(e,t,n.dialog.clientWidth);f.applyStyles(n.dialog,s),Eo(n,e)},vo=(e,t,n)=>{let s;e.initialPosition==="keep"?s=p.optimizeInitialPosition(t):s=wo(e.initialPosition,n);let r=p.convertToStyles(s);return Object.assign(r,e.normalDialogStyles)},Eo=async(e,t)=>{let n=o=>f.replace(e.content,o);if(on.attach(t,e.dialog,o=>n(o)).catch(o=>{console.error(o),alert(o.message)}),await O.isDataReady())return;let r=f.create(`<span style="font-size: 1.3rem; font-family: 'hiragino kaku gothic pro', meiryo, sans-serif;">${A("needToPrepareDict")}</span>`);f.replace(e.content,r),n=async()=>{await O.isDataReady()&&(n=o=>f.replace(e.content,o))}},cn=5,wo=(e,t)=>{let n={};switch(e){case"right":n.left=document.documentElement.clientWidth-t-cn;break;case"left":n.left=cn;break}return n};var bo=async()=>{await hn()};bo();})();
/*! Bundled license information:

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)
*/
